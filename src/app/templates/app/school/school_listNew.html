{% extends 'app/header_baseNew.html' %}
{% block nav_school%}
    class="item active"
{% endblock %}
{% load static %}
{% load app_extras %}

{% block script %}

<script>
    pk.initPopovers();
</script>

    {% if has_coordinate == False %}
        <script>
            function run() {
                if (navigator.geolocation) {
                    var options = {
                        enableHighAccuracy: true,
                        timeout: 15000,
                        maximumAge: 0
                    };
                    navigator.geolocation.getCurrentPosition(showPosition, error, options);
                } else {
                    x.innerHTML = "Geolocation is not supported by this browser.";
                }
            }
            function showPosition(position) {
                var latitude = position.coords.latitude.toString()
                var longitude = position.coords.longitude.toString()
                var searchParams = new URLSearchParams(window.location.search);
                searchParams.set('latitude', latitude.toString())
                searchParams.set('longitude', longitude.toString())
                window.location.search = searchParams.toString()
            }

            function error(err) {
                console.warn(`ERROR(${err.code}): ${err.message}`);
                setTimeout(run, 1000);
            }
            run()
        </script>
    {% endif %}
    <script
        async
        defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCUH4ybclQQPb9WiYYoY1gMLNyq3WaUQ1E&callback=initMap">
    </script>
    <script>
        function sortAsc () {
            var searchParams = new URLSearchParams(window.location.search);
            searchParams.delete('sortAsc');
            searchParams.delete('page');
            window.location.search = searchParams.toString();
        }
        function sortDesc () {
            var searchParams = new URLSearchParams(window.location.search);
            searchParams.set('sortAsc', 'flip');
            searchParams.delete('page');
            window.location.search = searchParams.toString();
        }
        function removeAlphabet () {
            var searchParams = new URLSearchParams(window.location.search);
            searchParams.delete('alphabet');
            window.location.search = searchParams.toString();
        }
        function initMap() {
            var latStr = '{{ latitude }}';
            var lngStr = '{{ longitude }}';
            var latlng = {
                lat: parseFloat(latStr),
                lng: parseFloat(lngStr)
            };
            if (latlng.lat && latlng.lng) {
                var geocoder = new google.maps.Geocoder();
                geocoder.geocode({'location': latlng}, function(results, status) {
                    if (status === 'OK') {
                        if (results[0]) {
                            span = document.getElementById('curentLocationAddress')
                            span.innerHTML = "Your location: " + results[0].formatted_address
                        }
                    }
                });
            }
        }
        function submitSearch () {
            var searchParams = new URLSearchParams(window.location.search);
            score = document.getElementById('scoreSchool')

            if (score.value) {
              if(score.value<=300 && score.value >=0)
                searchParams.set('score', score.value)
                else {
                  $("#errorMessages").show().append('<li>Please enter valid PSLE score</li>');
                    return;
                }
            } else {
                searchParams.delete('score')
            }

            distance = document.getElementById('distanceSchool')
            input = distance.querySelector('input')
            if (input.value != 'ALL' && input.value) {
                searchParams.set('distance', input.value)
            } else {
                searchParams.delete('distance')
            }

            var zoneNorth = document.getElementById('zoneNorth')
            var zoneSouth = document.getElementById('zoneSouth')
            var zoneEast = document.getElementById('zoneEast')
            var zoneWest = document.getElementById('zoneWest')
            var spIP = document.getElementById('spIP')
            var spSAP = document.getElementById('spSAP')
            var spNone = document.getElementById('spNone')
            var chineseMT = document.getElementById('chineseMT')
            var malayMT = document.getElementById('malayMT')
            var tamilMT = document.getElementById('tamilMT')
            var stmExp = document.getElementById('stmExp')
            var stmNA = document.getElementById('stmNA')
            var stmNT = document.getElementById('stmNT')

            if (!zoneNorth.checked) {
                searchParams.set('zoneNorth', 'false')
            } else {
                searchParams.delete('zoneNorth');
            }

            if (!zoneSouth.checked) {
                searchParams.set('zoneSouth', 'false')
            } else {
                searchParams.delete('zoneSouth');
            }

            if (!zoneEast.checked) {
                searchParams.set('zoneEast', 'false')
            } else {
                searchParams.delete('zoneEast');
            }

            if (!zoneWest.checked) {
                searchParams.set('zoneWest', 'false')
            } else {
                searchParams.delete('zoneWest');
            }

            if (!spIP.checked) {
                searchParams.set('spIP', 'false')
            } else {
                searchParams.delete('spIP');
            }

            if (!spSAP.checked) {
                searchParams.set('spSAP', 'false')
            } else {
                searchParams.delete('spSAP');
            }

            if (!spNone.checked) {
                searchParams.set('spNone', 'false')
            } else {
                searchParams.delete('spNone');
            }

            if (!chineseMT.checked) {
                searchParams.set('chineseMT', 'false')
            } else {
                searchParams.delete('chineseMT');
            }

            if (!malayMT.checked) {
                searchParams.set('malayMT', 'false')
            } else {
                searchParams.delete('malayMT');
            }

            if (!tamilMT.checked) {
                searchParams.set('tamilMT', 'false')
            } else {
                searchParams.delete('tamilMT');
            }
            /*
            if (!stExp.checked) {
                searchParams.set('stExp', 'false')
            } else {
                searchParams.delete('stExp');
            }

            if (!stmNA.checked) {
                searchParams.set('stmNA', 'false')
            } else {
                searchParams.delete('stmNA');
            }

            if (!stmNT.checked) {
                searchParams.set('stmNT', 'false')
            } else {
                searchParams.delete('stmNT');
            }*/

            searchParams.delete('page');
            window.location.search = searchParams.toString()
        }
        $(document).ready(function() {
            $('.browse')
                .popup({
                    inline: true,
                    position: 'bottom left',
                    on: 'click',
                    delay: {
                        show: 300,
                        hide: 800
                    }
                })
            $('.dropdown').dropdown();
            $("#scoreSchool").keyup(function(event) {
                if (event.keyCode === 13) {
                    $("#submitSearchBtn").click();
                }
            });

        })
    </script>
{% endblock %}

{% block content %}
<div class="wrapper">
    <div class="page-header page-header-xs" data-parallax="true" style="background-image: url({% static '/faces/login-image.jpg' %});">
        <div class="filter"></div>
        <div class="content">
            <div class="motto text-center">
                <h2 class="title-uppercase text-center">Schools</h2>
            </div>
        </div>
    </div>
    <div class="main">
        <div class="section">
            <div class="container">

                <div class="row">
                    <div class="col-md-12 ml-auto mr-auto">

                        <div class="row">
                            <div class="col-md-12 ml-auto mr-auto">
                                <div class="btn-toolbar">
                                    <div class="btn-group btn-group-sm">
                                      {% for item in school_alphabet %}
                                        <a class="btn btn-outline-default {% if item.disabled %}disabled {% endif %}{% if params.alphabet == item.alphabet %}active {% endif %}" href="?alphabet={{item.alphabet}}{{ params_text_without_alphabet }}">
                                          {{ item.alphabet }}
                                        </a>
                                        {% endfor %}
                                        <button class="btn btn-outline-default" onclick="sortAsc()"><i class="fa fa-sort-alpha-asc" aria-hidden="true"></i></button>
                                        <button class="btn btn-outline-default" onclick="sortDesc()"><i class="fa fa-sort-alpha-desc" aria-hidden="true"></i></button>
                                        <button type="button" class="btn btn-outline-danger text-right" data-toggle="modal" data-target="#myModal">
                                            Filters<i class="fa fa-filter" aria-hidden="true"></i>
                                        </button>
                                    </div>

                                </div>

                                </div>
                            </div>
            <div class="divider"></div>
                        <div class="row">
                                <div class="col-md-3 col-sm-6 mt-4">
                                  {% for school in school_list %}
                                        <div class="card-container">
                                            <div class="card">
                                                <div class="front" style="height:350px">
                                                    <div class="cover">
                                                        <img src="{% static '/faces/antoine-barres.jpg' %}" />
                                                    </div>
                                                    <div class="user">
                                                        <img class="img-circle" src="{% static school.logo_name %}" />
                                                    </div>
                                                    <div class="content">
                                                        <div class="main">
                                                            <h3 class="name">{{ school.school_name }}</h3>
                                                        </div>
                                                    </div>
                                                </div> <!-- end front panel -->
                                                <div class="back" style="height:350px">
                                                    <div class="header">
                                                        <!--put mission of school, maximum word count at most 100-->
                                                        <h5 class="motto">{{ school.visionstatement_desc }} </h5>

                                                    </div>
                                                    <div class="content">
                                                        <div class="main">
                                                            <h4 class="text-center">Cut Off Points</h4>

                                                            <p class="text-center">
                                                                Express: {{ school.express_nonaff_lower }} - {{ school.express_nonaff_upper }}<br />
                                                                Normal Academic: {{ school.normal_academic_nonaff_lower }} - {{ school.normal_academic_nonaff_upper}}<br />
                                                                Normal Technical: {{ school.normal_technical_nonaff_lower }} - {{ school.normal_technical_nonaff_upper }}

                                                            </p>
                                                            <p class="text-center">
                                                                <a class="btn btn-outline-danger btn-round" href="{% url 'app:school_detail' school.id %}">More Details</a><br /><br />
                                                                <!--if not yet bookmarked or compare, class is btn-outline-->
                                                                {% if user.is_authenticated %}
                                                                    {% if school|is_bookmarked:request.user == True %}
                                                                        {% if has_coordinate == True %}
                                                                            <a class="btn btn-danger btn-round btn-sm" href="{% url 'app:unbookmark' school.id %}?latitude={{ latitude }}&longitude={{ longitude }}">
                                                                        {% else %}
                                                                            <a class="btn btn-danger btn-round btn-sm" href="{% url 'app:unbookmark' school.id %}">
                                                                        {% endif %}
                                                                            Bookmark
                                                                        </a>
                                                                    {% else %}
                                                                        {% if has_coordinate == True %}
                                                                            <a class="btn btn-outline-danger btn-round btn-sm" href="{% url 'app:bookmark' school.id %}?latitude={{ latitude }}&longitude={{ longitude }}">
                                                                        {% else %}
                                                                            <a class="btn btn-outline-danger btn-round btn-sm" href="{% url 'app:bookmark' school.id %}">
                                                                        {% endif %}
                                                                            Bookmark
                                                                        </a>
                                                                    {% endif %}
                                                                {% endif %}

                                                                {% if school|is_compared:request == True %}
                                                                    <a class="btn btn-danger btn-round btn-sm" href="{% url 'app:remove_from_comparison' school.id %}">
                                                                        Compared
                                                                    </a>
                                                                {% else %}
                                                                    {% if allow_compare %}
                                                                        <a class="btn btn-outline-danger btn-round btn-sm" href="{% url 'app:add_to_comparison' school.id %}">
                                                                            Compared
                                                                        </a>
                                                                    {% else %}
                                                                        <a class="btn btn-outline-danger btn-round btn-sm disabled">
                                                                            Max 6 comparison
                                                                        </a>
                                                                    {% endif %}
                                                                {% endif %}
                                                                <br />
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div> <!-- end back panel -->
                                            </div> <!-- end card -->
                                          </div> <!-- end card-container -->
                                        {% endfor %}
                                    </div>
                                </div>

                                <div class="row">
                                    <nav aria-label="...">
                                        <ul class="pagination">
                                          {% if school_list.has_previous %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ school_list.previous_page_number }}{{ params_text }}" tabindex="-1">Previous<span class="sr-only">(current)</span></a>
                                            </li>
                                            {% else %}
                                            <li class="page-item disabled">
                                                <a class="page-link" tabindex="-1">Previous<span class="sr-only">(current)</span></a>
                                            </li>
                                            {% endif %}
                                            {% if school_list.number|add:"-1" > 1 %}
                                                <li class="page-item">
                                                <a class="page-link" href="?page=1{{ params_text }}">
                                                    1
                                                </a></li>
                                                {% if school_list.number|add:"-2" > 1 %}
                                                    <li class="page-item disabled">...</li>
                                                {% endif %}
                                            {% endif %}
                                            {% if school_list.has_previous %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ school_list.previous_page_number }}{{ params_text }}">
                                                    {{ school_list.previous_page_number }}
                                                </a></li>
                                            {% endif %}
                                            <li class="page-item active"><a class="page-link">{{ school_list.number }}</a></li>
                                            {% if school_list.has_next %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ school_list.next_page_number }}{{ params_text }}">
                                                    {{ school_list.next_page_number }}
                                                </a></li>
                                            {% endif %}

                                            {% if school_list.number|add:"1" < school_list.paginator.num_pages %}
                                                {% if school_list.number|add:"2" < school_list.paginator.num_pages %}
                                                  <li class="page-item disabled">...</li>
                                                {% endif %}
                                                <li class="page-item">
                                                    <a class="page-link" href="?page={{ school_list.paginator.num_pages }}{{ params_text }}">
                                                        {{ school_list.paginator.num_pages }}
                                                    </a></li>
                                            {% endif %}
                                            {% if school_list.has_next %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ school_list.next_page_number }}{{ params_text }}">Next</a>
                                            </li>
                                            {% else %}
                                            <li class="page-item disabled">
                                                <a class="page-link" >Next</a>
                                            </li>
                                            {% endif %}
                                        </ul>
                                    </nav>
                                </div>

                            </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <div class="nav-tabs-navigation">
                    <div class="nav-tabs-wrapper">
                        <ul id="tabs" class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="tab" href="#home" role="tab">Filters</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#profile" role="tab">CCA</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="my-tab-content" class="tab-content">

                    <div class="tab-pane active" id="home" role="tabpanel">
                        <div class="row">
                            <div class="col-md-2">
                                <p>Zone</p>
                            </div>
                            <div class="col-md-10">
                                <div class="form-check">
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="checkbox" value="" checked>
                                        North
                                        <span class="form-check-sign"></span>
                                    </label>
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="checkbox" value="" checked>
                                        South
                                        <span class="form-check-sign"></span>
                                    </label>
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="checkbox" value="" checked>
                                        East
                                        <span class="form-check-sign"></span>
                                    </label>
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="checkbox" value="" checked>
                                        West
                                        <span class="form-check-sign"></span>
                                    </label>
                                </div>

                            </div>
                        </div>
                        <hr />
                        <div class="row">
                            <div class="col-md-4">
                                <p>Special Programme(SP)</p>
                            </div>
                            <div class="col-md-8">
                                <div class="form-check">
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="checkbox" value="" checked>
                                        IP
                                        <span class="form-check-sign"></span>
                                    </label>
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="checkbox" value="" checked>
                                        SAP
                                        <span class="form-check-sign"></span>
                                    </label>
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="checkbox" value="" checked>
                                        Non SP
                                        <span class="form-check-sign"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="row">
                            <div class="col-md-4">
                                <p>Mother Tongue</p>
                            </div>
                            <div class="col-md-8">
                                <div class="form-check">
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="checkbox" value="" checked>
                                        Chinese
                                        <span class="form-check-sign"></span>
                                    </label>
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="checkbox" value="" checked>
                                        Malay
                                        <span class="form-check-sign"></span>
                                    </label>
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="checkbox" value="" checked>
                                        Tamil
                                        <span class="form-check-sign"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane" id="profile" role="tabpanel">
                        <div class="row">
                            <div class="col-md-12">
                                <a href="#" class="btn btn-outline-info" data-toggle="collapse" data-target="#demo">PHYSICAL SPORTS</a>
                                <div id="demo" class="collapse mt-2">
                                    <div class="form-check">
                                        <label class="form-check-label">
                                            <input class="form-check-input" type="checkbox" value="" checked>
                                            CLUBS AND SOCIETIES
                                            <span class="form-check-sign"></span>
                                        </label><br />
                                        <label class="form-check-label">
                                            <input class="form-check-input" type="checkbox" value="" checked>
                                            PHYSICAL SPORTS
                                            <span class="form-check-sign"></span>
                                        </label><br />
                                        <label class="form-check-label">
                                            <input class="form-check-input" type="checkbox" value="" checked>
                                            UNIFORMED GROUPS
                                            <span class="form-check-sign"></span>
                                        </label><br />
                                        <label class="form-check-label">
                                            <input class="form-check-input" type="checkbox" value="" checked>
                                            VISUAL AND PERFORMING ARTS
                                            <span class="form-check-sign"></span>
                                        </label>
                                    </div>
                                </div>
                                <hr />
                                <a href="#" class="btn btn-outline-info" data-toggle="collapse" data-target="#others">OTHERS</a>
                                <div id="others" class="collapse mt-2">
                                    <div class="form-check">
                                        <label class="form-check-label">
                                            <input class="form-check-input" type="checkbox" value="" checked>
                                            CLUBS AND SOCIETIES
                                            <span class="form-check-sign"></span>
                                        </label><br />
                                        <label class="form-check-label">
                                            <input class="form-check-input" type="checkbox" value="" checked>
                                            PHYSICAL SPORTS
                                            <span class="form-check-sign"></span>
                                        </label><br />
                                        <label class="form-check-label">
                                            <input class="form-check-input" type="checkbox" value="" checked>
                                            UNIFORMED GROUPS
                                            <span class="form-check-sign"></span>
                                        </label><br />
                                        <label class="form-check-label">
                                            <input class="form-check-input" type="checkbox" value="" checked>
                                            VISUAL AND PERFORMING ARTS
                                            <span class="form-check-sign"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="left-side">
                    <button type="button" class="btn btn-default btn-link">Reset</button>
                </div>
                <div class="divider"></div>
                <div class="right-side">
                    <button type="button" class="btn btn-danger btn-link">Submit</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
